<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Produto</title>
    <link rel="stylesheet" type="text/css" href="styles.css" media="screen" />
    <script>
        const apiUrl = "http://localhost:3000"; // Alterar para o URL do backend em produção

        // Função para carregar os dados do produto baseado no SKU
        async function carregarProduto() {
            const urlParams = new URLSearchParams(window.location.search);
            const sku = urlParams.get("sku");

            if (!sku) {
                alert("SKU não especificado!");
                return;
            }

            try {
                const response = await fetch(`${apiUrl}/produtos/${sku}`);
                if (!response.ok) {
                    throw new Error("Erro ao buscar o produto!");
                }

                const produto = await response.json();

                // Preencher os campos com os dados do produto
                document.getElementById("codigo").value = produto.codigo;
                document.getElementById("nome").value = produto.produto;
                document.getElementById("cor").value = produto.cor;
                document.getElementById("espessura").value = produto.espessura;
                document.getElementById("peso").value = produto.peso;
                document.getElementById("sku").value = produto.sku;
            } catch (error) {
                alert("Erro ao carregar os dados do produto: " + error.message);
            }
        }

        // Função para salvar as alterações
        async function salvarAlteracoes() {
            const codigo = document.getElementById("codigo").value;
            const nome = document.getElementById("nome").value;
            const cor = document.getElementById("cor").value;
            const espessura = document.getElementById("espessura").value;
            const peso = document.getElementById("peso").value;
            const sku = document.getElementById("sku").value;

            const produtoAtualizado = { codigo, produto: nome, cor, espessura, peso, sku };

            try {
                const response = await fetch(`${apiUrl}/produtos/${sku}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(produtoAtualizado),
                });

                if (!response.ok) {
                    throw new Error("Erro ao salvar alterações!");
                }

                alert("Produto atualizado com sucesso!");
                window.location.href = "listagem.html"; // Redirecionar para a página de listagem
            } catch (error) {
                alert("Erro ao salvar alterações: " + error.message);
            }
        }

        // Carregar os dados do produto ao iniciar
        window.onload = carregarProduto;
    </script>
</head>
<body>
    <h1>Editar Produto</h1>
    <form onsubmit="event.preventDefault(); salvarAlteracoes();">
        <label for="codigo">Código:</label>
        <input type="text" id="codigo" readonly />

        <label for="nome">Nome do Produto:</label>
        <input type="text" id="nome" required />

        <label for="cor">Cor:</label>
        <input type="text" id="cor" required />

        <label for="espessura">Espessura:</label>
        <input type="text" id="espessura" required />

        <label for="peso">Peso:</label>
        <input type="text" id="peso" required />

        <label for="sku">SKU:</label>
        <input type="text" id="sku" readonly />

        <button type="submit">Salvar Alterações</button>
        <button type="button" onclick="window.location.href='listagem.html'">Cancelar</button>
    </form>
</body>
</html>
